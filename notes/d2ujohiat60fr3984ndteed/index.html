<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Fast Knowledge Distillation for CNNs</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="kavlogs"/><meta property="og:title" content="Fast Knowledge Distillation for CNNs"/><meta property="og:description" content="kavlogs"/><meta property="og:url" content="https://kavorite.github.io/vault/notes/d2ujohiat60fr3984ndteed/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="5/22/2022"/><meta property="article:modified_time" content="7/29/2022"/><link rel="canonical" href="https://kavorite.github.io/vault/notes/d2ujohiat60fr3984ndteed/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/vault/_next/static/css/bec73badd4e5ba88.css" as="style"/><link rel="stylesheet" href="/vault/_next/static/css/bec73badd4e5ba88.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/vault/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/vault/_next/static/chunks/webpack-3af8c0cde089b23c.js" defer=""></script><script src="/vault/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/vault/_next/static/chunks/main-34d019fcedb697b6.js" defer=""></script><script src="/vault/_next/static/chunks/pages/_app-b20c4be9bb651ea8.js" defer=""></script><script src="/vault/_next/static/chunks/826-e0e455fb469c158f.js" defer=""></script><script src="/vault/_next/static/chunks/986-737e5da213076068.js" defer=""></script><script src="/vault/_next/static/chunks/pages/notes/%5Bid%5D-00dd1421f3ce3a3e.js" defer=""></script><script src="/vault/_next/static/x67zoUTAB0zyGOxjfffun/_buildManifest.js" defer=""></script><script src="/vault/_next/static/x67zoUTAB0zyGOxjfffun/_ssgManifest.js" defer=""></script><script src="/vault/_next/static/x67zoUTAB0zyGOxjfffun/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="fast-knowledge-distillation-for-cnns"><a aria-hidden="true" class="anchor-heading icon-link" href="#fast-knowledge-distillation-for-cnns"></a>Fast Knowledge Distillation for CNNs</h1>
<p>Using methods published by <a href="https://arxiv.org/abs/2112.01528">Shen, et al., 2021,</a> it's possible to perform <a href="/vault/notes/iu6ldvp95326hayrcvy9lg0">Knowledge Distillation</a> more sample-efficiently, echoing <a href="/vault/notes/uihquvh4fwgniynh3aly42g#fast-moco">Momentum Contrast</a>. The elevator pitch is that you create a pseudo-annotated dataset from many augmentations of the same image, alongside the output of the teacher's head, effectively creating many samples per forward pass of the teacher network, and allowing for a bespoke form of <a href="/vault/notes/166kq4lkh8d5asll0rspk2g">Data Echoing</a>: Images can be loaded once, resampled, and shipped over for preprocessing <em>on the hardware accelerator itself,</em> effectively providing a built-in echoing factor of however many augmented views are taken per image. Since I generally already apply sample-specific augmentations on the device during data echoing, the main performance gains to be expected are those from applying the teacher network to cropped spatial regions of the input (jigsaw assembly, again, similar to <a href="/vault/notes/jc56h8njgqawadlroex4ju1">Contrastive Learning</a>).</p>
<ol>
<li>Apply a set of deterministic, pseudo-random data augmentations (e.g., with <a href="https://github.com/4rtemi5/imax">RandAugment</a>). For most training regimes, this also should include a (deterministic) random crop. Store the result for retrieval in some capacity.</li>
<li>Apply the teacher model to augmented samples; store extracted features alongside the augmentation hyperparameters (bounding boxes for cropping, transformations applied). Persist the result.
<ul>
<li>In JAX, and other augmentation implementations with stateless PRNG, this could be as simple as making a note of the transformation <a href="https://jax.readthedocs.io/en/latest/jax.random.html">seed</a> such that it can be reproduced on accelerators during training using a single copy of the anchor image, which is what prompts my comparison to data echoing.</li>
</ul>
</li>
<li>Train the student model to emulate the output of the teacher. Can be done with standard KL divergence objectives or MSE for <a href="https://arxiv.org/abs/2105.08919">logit cloning</a> if you're feeling <em>exotic.</em></li>
</ol>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/vault/notes/uihquvh4fwgniynh3aly42g">Momentum Contrast (vault)</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"d2ujohiat60fr3984ndteed","title":"Fast Knowledge Distillation for CNNs","desc":"","updated":1659116468601,"created":1653182223624,"custom":{},"fname":"ref.cv.fast-distillation","type":"note","vault":{"fsPath":"vault"},"contentHash":"12d9135af82e4397143bbe2877c37645","links":[{"type":"wiki","from":{"fname":"ref.cv.fast-distillation","id":"d2ujohiat60fr3984ndteed","vaultName":"vault"},"value":"ref.opt.knowledge-distillation","alias":"ref.opt.knowledge-distillation","position":{"start":{"line":1,"column":82,"offset":81},"end":{"line":1,"column":116,"offset":115},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"ref.opt.knowledge-distillation"}},{"type":"wiki","from":{"fname":"ref.cv.fast-distillation","id":"d2ujohiat60fr3984ndteed","vaultName":"vault"},"value":"ref.cl.moco","alias":"ref.cl.moco","position":{"start":{"line":1,"column":150,"offset":149},"end":{"line":1,"column":175,"offset":174},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"ref.cl.moco","anchorHeader":"Fast-MoCo"}},{"type":"wiki","from":{"fname":"ref.cv.fast-distillation","id":"d2ujohiat60fr3984ndteed","vaultName":"vault"},"value":"ref.opt.data-echoing","alias":"ref.opt.data-echoing","position":{"start":{"line":1,"column":439,"offset":438},"end":{"line":1,"column":463,"offset":462},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"ref.opt.data-echoing"}},{"type":"wiki","from":{"fname":"ref.cv.fast-distillation","id":"d2ujohiat60fr3984ndteed","vaultName":"vault"},"value":"ref.cl","alias":"ref.cl","position":{"start":{"line":1,"column":936,"offset":935},"end":{"line":1,"column":946,"offset":945},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"ref.cl"}},{"from":{"fname":"ref.cl.moco","vaultName":"vault"},"type":"backlink","position":{"start":{"line":13,"column":70,"offset":1189},"end":{"line":13,"column":98,"offset":1217},"indent":[]},"value":"ref.cv.fast-distillation","alias":"ref.cv.fast-distillation"}],"anchors":{},"children":[],"parent":"wf5gku64lj2ag6n8kzs9o8f","data":{}},"body":"\u003ch1 id=\"fast-knowledge-distillation-for-cnns\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#fast-knowledge-distillation-for-cnns\"\u003e\u003c/a\u003eFast Knowledge Distillation for CNNs\u003c/h1\u003e\n\u003cp\u003eUsing methods published by \u003ca href=\"https://arxiv.org/abs/2112.01528\"\u003eShen, et al., 2021,\u003c/a\u003e it's possible to perform \u003ca href=\"/vault/notes/iu6ldvp95326hayrcvy9lg0\"\u003eKnowledge Distillation\u003c/a\u003e more sample-efficiently, echoing \u003ca href=\"/vault/notes/uihquvh4fwgniynh3aly42g#fast-moco\"\u003eMomentum Contrast\u003c/a\u003e. The elevator pitch is that you create a pseudo-annotated dataset from many augmentations of the same image, alongside the output of the teacher's head, effectively creating many samples per forward pass of the teacher network, and allowing for a bespoke form of \u003ca href=\"/vault/notes/166kq4lkh8d5asll0rspk2g\"\u003eData Echoing\u003c/a\u003e: Images can be loaded once, resampled, and shipped over for preprocessing \u003cem\u003eon the hardware accelerator itself,\u003c/em\u003e effectively providing a built-in echoing factor of however many augmented views are taken per image. Since I generally already apply sample-specific augmentations on the device during data echoing, the main performance gains to be expected are those from applying the teacher network to cropped spatial regions of the input (jigsaw assembly, again, similar to \u003ca href=\"/vault/notes/jc56h8njgqawadlroex4ju1\"\u003eContrastive Learning\u003c/a\u003e).\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eApply a set of deterministic, pseudo-random data augmentations (e.g., with \u003ca href=\"https://github.com/4rtemi5/imax\"\u003eRandAugment\u003c/a\u003e). For most training regimes, this also should include a (deterministic) random crop. Store the result for retrieval in some capacity.\u003c/li\u003e\n\u003cli\u003eApply the teacher model to augmented samples; store extracted features alongside the augmentation hyperparameters (bounding boxes for cropping, transformations applied). Persist the result.\n\u003cul\u003e\n\u003cli\u003eIn JAX, and other augmentation implementations with stateless PRNG, this could be as simple as making a note of the transformation \u003ca href=\"https://jax.readthedocs.io/en/latest/jax.random.html\"\u003eseed\u003c/a\u003e such that it can be reproduced on accelerators during training using a single copy of the anchor image, which is what prompts my comparison to data echoing.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eTrain the student model to emulate the output of the teacher. Can be done with standard KL divergence objectives or MSE for \u003ca href=\"https://arxiv.org/abs/2105.08919\"\u003elogit cloning\u003c/a\u003e if you're feeling \u003cem\u003eexotic.\u003c/em\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cstrong\u003eBacklinks\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/vault/notes/uihquvh4fwgniynh3aly42g\"\u003eMomentum Contrast (vault)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"ihfr21mlvz5lp3n62uu344t","title":"kavlogs","desc":"","updated":1659115143090,"created":1659018913792,"custom":{"nav_order":0,"permalink":"/"},"fname":"ref","type":"note","vault":{"fsPath":"vault"},"contentHash":"41b7e8cfe841b035025dfa85ec0b142e","links":[],"anchors":{},"children":["39acu8nb3xn6t18xul0ji8d","jc56h8njgqawadlroex4ju1","wf5gku64lj2ag6n8kzs9o8f","jlbuz8giyj93jsc1l0lmbzs","3c09ct2zvlk9dfitxexbss3"],"parent":null,"data":{},"body":"This is an assorted collection of notes and thoughts on things I've read about before. Here for my reference, and so that you can come here to read my background instead of receiving an untimely info-dump whose content just amounts to a recitation of anything here, out of mutual respect for my time and yours."},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"},{"fsPath":"projects"},{"fsPath":"tenets"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableHandlebarTemplates":true,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":true,"dendronVersion":"0.105.1"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":true},"publishing":{"theme":"dark","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteUrl":"https://kavorite.github.io","assetsPrefix":"/vault","siteHierarchies":["ref","pub"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"⚑","description":"kavlogs"},"github":{"enableEditLink":false,"editBranch":"main","editViewMode":"tree","editLinkText":"Edit this page on GitHub"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"siteFaviconPath":"favicon.ico","siteIndex":"ref"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"d2ujohiat60fr3984ndteed"},"buildId":"x67zoUTAB0zyGOxjfffun","assetPrefix":"/vault","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>